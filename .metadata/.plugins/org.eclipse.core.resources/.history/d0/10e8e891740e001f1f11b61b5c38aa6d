<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.fitnect.model.dao.GymDao">

    <resultMap id="gymResultMap" type="com.ssafy.fitnect.model.dto.Gym">
        <id property="gymId" column="gym_id"/>
        <result property="name" column="name"/>
        <result property="address" column="address"/>
        <result property="longitude" column="longitude"/>
        <result property="latitude" column="latitude"/>
        <result property="phone" column="phone"/>
        <result property="content" column="content"/>
        <result property="type" column="type"/>
        <result property="operationHours" column="operation_hours"/>
        <result property="closedDay" column="closed_day"/>
        <result property="gymImgUrl" column="gym_img_url"/>
        <result property="capacity" column="capacity"/>
        <result property="rating" column="rating"/>
        <result property="createdDate" column="created_date"/>
        <result property="modifiedDate" column="modified_date"/>

        <!-- Association mappings -->
        <association property="amenity" javaType="com.ssafy.fitnect.model.dto.Amenity">
            <id property="amenityId" column="amenity_id"/>
            <result property="freeParking" column="free_parking"/>
            <result property="paidParking" column="paid_parking"/>
            <result property="allDay" column="all_day"/>
            <result property="showerFacilities" column="shower_facilities"/>
            <result property="sportsWear" column="sports_wear"/>
            <result property="sharedLocker" column="shared_locker"/>
            <result property="personalLocker" column="personal_locker"/>
            <result property="unmanded" column="unmanded"/>
        </association>
        
        <!-- Collection mappings -->
        <collection property="clazz" ofType="com.ssafy.fitnect.model.dto.Class">
            <id property="classId" column="class_id"/>
            <result property="trainorId" column="trainor_id"/>
            <result property="name" column="class_name"/>
            <result property="startDate" column="start_date"/>
            <result property="endDate" column="end_date"/>
            <result property="createDate" column="create_date"/>
            <result property="minimum" column="minimum"/>
            <result property="current" column="current"/>
            <result property="maximum" column="maximum"/>
            <result property="price" column="price"/>
        </collection>
        
        <collection property="gymMachine" ofType="com.ssafy.fitnect.model.dto.GymMachine">
            <id property="infoId" column="info_id"/>
            <result property="machineCount" column="machine_count"/>
            <result property="machineName" column="machine_name"/>
        </collection>
    </resultMap>
    
    <select id="selectAllGym" resultMap="gymResultMap">
        SELECT
            g.gym_id,
            g.name,
            g.address,
            g.longitude,
            g.latitude,
            g.phone,
            g.content,
            g.type,
            g.operation_hours,
            g.closed_day,
            g.gym_img_url,
            g.capacity,
            g.rating,
            g.created_date,
            g.modified_date,
            a.amenity_id,
            a.free_parking,
            a.paid_parking,
            a.all_day,
            a.shower_facilities,
            a.sports_wear,
            a.shared_locker,
            a.personal_locker,
            a.unmanded,
            c.class_id,
            c.trainor_id,
            c.class_name,
            c.start_date,
            c.end_date,
            c.create_date,
            c.minimum,
            c.current,
            c.maximum,
            c.price,
            m.info_id,
            m.machine_count,
            m.machine_name
        FROM gym g
        LEFT JOIN amenity a ON g.gym_id = a.gym_id
        LEFT JOIN class c ON g.gym_id = c.gym_id
        LEFT JOIN gym_machine m ON g.gym_id = m.gym_id
        WHERE g.gym_id = #{gymId}
    </select>


</mapper>