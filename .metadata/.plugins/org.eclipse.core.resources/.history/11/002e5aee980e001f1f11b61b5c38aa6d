<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.fitnect.model.dao.GymDao">

    <!-- Amenity resultMap -->
    <resultMap id="amenityResultMap" type="com.ssafy.fitnect.model.dto.Amenity">
        <id property="amenityId" column="amenityId"/>
        <result property="freeParking" column="freeParking"/>
        <result property="paidParking" column="paidParking"/>
        <result property="allDay" column="allDay"/>
        <result property="showerFacilities" column="showerFacilities"/>
        <result property="sportsWear" column="sportsWear"/>
        <result property="sharedLocker" column="sharedLocker"/>
        <result property="personalLocker" column="personalLocker"/>
        <result property="unmanded" column="unmanded"/>
    </resultMap>

    <!-- Class resultMap -->
    <resultMap id="classResultMap" type="com.ssafy.fitnect.model.dto.Class">
        <id property="classId" column="classId"/>
        <result property="trainorId" column="trainorId"/>
        <result property="name" column="name"/>
        <result property="startDate" column="startDate"/>
        <result property="endDate" column="endDate"/>
        <result property="createDate" column="createDate"/>
        <result property="minimum" column="minimum"/>
        <result property="current" column="current"/>
        <result property="maximum" column="maximum"/>
        <result property="price" column="price"/>
    </resultMap>

    <!-- GymMachine resultMap -->
    <resultMap id="gymMachineResultMap" type="com.ssafy.fitnect.model.dto.GymMachine">
        <id property="infoId" column="infoId"/>
        <result property="machineCount" column="machineCount"/>
        <result property="machineName" column="machineName"/>
    </resultMap>

    <!-- Prices resultMap -->
    <resultMap id="pricesResultMap" type="com.ssafy.fitnect.model.dto.Prices">
        <id property="priceId" column="priceId"/>
        <result property="name" column="name"/>
        <result property="price" column="price"/>
        <result property="text" column="text"/>
    </resultMap>

    <!-- Gym resultMap -->
    <resultMap id="gymResultMap" type="com.ssafy.fitnect.model.dto.Gym">
        <!-- Your existing mappings -->
        <id property="gymId" column="gymId"/>
        <result property="name" column="name"/>
        <result property="address" column="address"/>
        <result property="longitude" column="longitude"/>
        <result property="latitude" column="latitude"/>
        <result property="phone" column="phone"/>
        <result property="content" column="content"/>
        <result property="type" column="type"/>
        <result property="operationHours" column="operationHours"/>
        <result property="closedDay" column="closedDay"/>
        <result property="gymImgUrl" column="gymImgUrl"/>
        <result property="capacity" column="capacity"/>
        <result property="rating" column="rating"/>
        <result property="createdDate" column="createdDate"/>
        <result property="modifiedDate" column="modifiedDate"/>
        
<!-- Association mappings -->
<association property="amenity" resultMap="amenityResultMap" fetchType="eager"/>

<!-- Collection mappings -->
<collection property="clazz" ofType="java.util.Map" resultMap="classResultMap" fetchType="eager"/>
<collection property="gymMachine" ofType="java.util.Map" resultMap="gymMachineResultMap" fetchType="eager"/>
<collection property="prices" ofType="java.util.Map" resultMap="pricesResultMap" fetchType="eager"/>
    </resultMap>
    
<select id="selectAllGymWithAsso" resultMap="gymResultMap">
    SELECT
        g.gymId,
        g.name,
        g.address,
        g.longitude,
        g.latitude,
        g.phone,
        g.content,
        g.type,
        g.operationHours,
        g.closedDay,
        g.gymImgUrl,
        g.capacity,
        g.rating,
        g.createdDate,
        g.modifiedDate,
        a.amenityId,
        a.freeParking,
        a.paidParking,
        a.allDay,
        a.showerFacilities,
        a.sportsWear,
        a.sharedLocker,
        a.personalLocker,
        a.unmanded,
        c.classId,
        c.trainorId,
        c.name,
        c.startDate,
        c.endDate,
        c.createdDate,
        c.minimum,
        c.current,
        c.maximum,
        c.price,
        m.infoId,
        m.machineCount,
        m.machineName,
        p.priceId,
        p.gymId,
        p.name,
        p.price,
        p.text
    FROM gym g
    LEFT JOIN amenity a ON g.gymId = a.gymId
    LEFT JOIN class c ON g.gymId = c.gymId
    LEFT JOIN gym_machine m ON g.gymId = m.gymId
    LEFT JOIN prices p ON g.gymId = p.gymId
    GROUP BY g.gymId, a.amenityId, c.classId, m.infoId, p.priceId
</select>
    
    <select id="selectAllGym">
        SELECT * FROM GYM
    </select>

</mapper>
